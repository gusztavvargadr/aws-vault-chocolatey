steps:
- template: azure-pipelines.core.init-dotnet-tools.yml

- script: |
    dotnet cake build.cake --target=publish --artifacts-directory=$(Build.ArtifactStagingDirectory) --app-version=$(version-app) --package-version=$(version-package)
  displayName: Build - Publish

- task: PublishPipelineArtifact@0
  displayName: Publish - Artifacts
  inputs:
    artifactName: ci-build
    targetPath: $(Build.ArtifactStagingDirectory)

- script: |
    dotnet cake build.cake --target=clean --artifacts-directory=$(Build.ArtifactStagingDirectory) --app-version=$(version-app) --package-version=$(version-package)
  displayName: Clean - Build
  condition: always()
