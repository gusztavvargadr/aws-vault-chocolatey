jobs:
  - job: build
    displayName: Build

    pool:
      vmImage: windows-2019

    steps:
      - template: azure-pipelines.core.yml

      - script: |
          dotnet cake build.cake --target=publish --project-version=$(project-version) --package-version=$(package-version)
        displayName: Publish Cake

      - script: |
          dotnet cake build.cake --target=clean --project-version=$(project-version) --package-version=$(package-version)
        displayName: Clean Cake
        condition: always()

      - publish: $(Build.SourcesDirectory)/artifacts/chocolatey/
        displayName: Publish Chocolatey Artifacts
        artifact: build-chocolatey
        condition: always()
