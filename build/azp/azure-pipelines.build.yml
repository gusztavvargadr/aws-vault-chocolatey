jobs:
  - job: build
    displayName: Build

    pool:
      vmImage: windows-2019

    steps:
      - template: azure-pipelines.core.yml

      - script: |
          dotnet cake build.cake --target=publish --package-version=$(package-version) --project-version=$(project-version)
        displayName: Publish Cake

      - script: |
          dotnet cake build.cake --target=clean --package-version=$(package-version) --project-version=$(project-version)
        displayName: Clean Cake
        condition: always()

      - publish: $(Build.SourcesDirectory)/artifacts/chef/
        displayName: Publish Chef Artifacts
        artifact: build-chef
        condition: always()

      - publish: $(Build.SourcesDirectory)/artifacts/chocolatey/
        displayName: Publish Chocolatey Artifacts
        artifact: build-chocolatey
        condition: always()
