jobs:
  - job: build
    displayName: Build

    pool:
      name: Default
      demands:
        - AZP_AGENT_WINDOWS
        - AZP_AGENT_DOCKER

    workspace:
      clean: all

    steps:
      - template: azure-pipelines.core.yml

      - script: |
          dotnet cake build.cake --target=publish
        displayName: Publish Cake

      - publish: $(Build.SourcesDirectory)/artifacts/chocolatey/
        displayName: Publish Chocolatey Artifacts
        condition: always()
        artifact: build-chocolatey

      - script: |
          dotnet cake build.cake --target=clean
        displayName: Clean Cake
        condition: always()
