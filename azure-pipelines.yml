trigger:
- master
- feature*/*
- refs/tags/*

pr: none

stages:
- stage: ci
  displayName: ci

  jobs:
  - job: build
    displayName: Build
    pool:
      vmImage: windows-2019

    steps:
    - script: |
        dotnet tool install Cake.Tool --global --version 0.33.0
        dotnet tool install GitVersion.Tool --global --version 4.0.1-beta1-65
      displayName: Init - .NET - Tools

    - script: |
        dotnet cake build.cake --target=publish
      displayName: Build - Publish

    - task: ArchiveFiles@2
      displayName: Artifacts - Archive
      inputs:
        rootFolderOrFile: $(Build.SourcesDirectory)
        includeRootFolder: false
        archiveType: zip
        archiveFile: '$(Build.ArtifactStagingDirectory)/source.zip'

    - task: PublishPipelineArtifact@0
      displayName: Artifacts - Publish
      inputs:
        targetPath: '$(Build.ArtifactStagingDirectory)'
        artifactName: ci-build
