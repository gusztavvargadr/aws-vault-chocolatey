trigger:
- master
- feature/*
- hotfix/*
- refs/tags/*

pr: none

stages:
- stage: ci
  displayName: CI

  jobs:
  - job: build
    displayName: Build
    pool:
      vmImage: windows-2019
    variables:
    - group: version-4.6.0

    steps:
    - template: build/azure-pipelines.ci.build.yml

- stage: cd
  displayName: CD

  jobs:
  - job: deployLocalhost
    displayName: Deploy - localhost
    pool:
      vmImage: windows-2019
    variables:
    - group: version-4.6.0
    - group: chocolatey-source-localhost

    steps:
    - template: build/azure-pipelines.cd.deploy.yml

  - job: deployChocolateyOrg
    displayName: Deploy - chocolatey.org
    pool:
      vmImage: windows-2019
    variables:
    - group: version-4.6.0
    - group: chocolatey-source-chocolateyorg
    dependsOn: deployLocalhost
    condition: and(succeeded(), startsWith(variables['Build.SourceBranch'], 'refs/tags/'))

    steps:
    - template: build/azure-pipelines.cd.deploy.yml
